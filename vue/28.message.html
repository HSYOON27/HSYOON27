<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messenger</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
    <style> 
        * {
            font-family: 'Noto Sans KR', sans-serif;
        }
    </style>

    <!-- <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"> -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.2.3/cosmo/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <style>
        /* width */
        ::-webkit-scrollbar {
            width: 2px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: #74b9ff;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #0984e3;
        }

        .jumbotron {
            position: fixed;
            background-color: white;
            padding: 10px;
            top:0;
            left:0;
            right:0;
        }

        .room-image {
            min-width:50px;
            width:100%;
        }
        @media screen and (max-width:576px) {
            .room-image {
                display: none;
            }
        }
        .message-wrapper {
            background-color: rgba(186, 206, 224);
            overflow: hidden;
        }
        .message-wrapper > .message {
            display: flex;
            font-size: 16px;
            margin-top: 0.65em;
        }
        .message-wrapper > .message > .profile-wrapper {
            min-width: 50px;
            max-width: 50px;
        }
        .message-wrapper > .message > .profile-wrapper > img {
            border-radius: 50%;
            width:100%;
        }
        .message-wrapper > .message > .content-wrapper {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 0 0.5em;
        }
        .message-wrapper > .message > .content-wrapper > .content-header {
            font-size: 1.02em;
        }
        .message-wrapper > .message > .content-wrapper > .content-body {
            display: flex;
            font-weight: lighter;
            padding-top: 0.35em;
            align-items: flex-end;
        }
        .message-wrapper > .message > .content-wrapper > .content-body > .message-wrapper {
            background-color: white;
            font-size: 0.85em;
            padding: 0.5em;
            border-radius: 0.25em;
            max-width: 500px;
            word-break: break-all;
        }
        .message-wrapper > .message > .content-wrapper > .content-body > .info-wrapper {
            min-width: 50px;
        }
        .message-wrapper > .message > .content-wrapper > .content-body > .info-wrapper > .time-wrapper {
            font-size: 0.5em;
            padding: 0 0.25em;
        }
        .message-wrapper > .message > .content-wrapper > .content-body > .info-wrapper > .number-wrapper {
            font-size: 0.5em;
            padding: 0 0.25em;
            color: rgba(255, 235, 51);
        }

        .message-wrapper > .message.my > .content-wrapper > .content-header {
            text-align: right;
        }
        .message-wrapper > .message.my > .content-wrapper > .content-body {
            flex-direction: row-reverse;
        }
        .message-wrapper > .message.my > .content-wrapper > .content-body > .message-wrapper {
            background-color: rgba(255, 235, 51);
        }
        .message-wrapper > .message.my > .content-wrapper > .content-body > .info-wrapper > .time-wrapper {
            text-align: right;
            padding-right: 0.45em;
        }
        .message-wrapper > .message.my > .content-wrapper > .content-body > .info-wrapper > .number-wrapper {
            text-align: right;
            padding-right: 0.45em;
        }

        .input-wrapper {
            position: fixed;
            bottom:0;
            left:0;
            right:0;
            background-color: white;
        }
        .input-wrapper > .textarea-wrapper {}
        .input-wrapper > .textarea-wrapper > textarea {
            resize: none;
            width:100%;
            height:120px;
            border:1px solid gray;
            outline: none;
        }
        .input-wrapper > .button-wrapper {
            display: flex;
            justify-content: space-between;
        }
        .input-wrapper > .button-wrapper > .btn-send {
            background-color: rgb(255, 235, 51);
            color: gray;
            border: none;
            font-size: 10px;
            padding: 0.75em 1.5em;
        }
    </style>
</head>
<body>

    <div class="container-fluid mt-4" id="app">

        <div class="row">
            <div class="offset-md-2 col-md-8">

                <!-- 문서 제목 (Jumbotron) -->
                <div class="jumbotron">
                    <div class="row">
                        <div class="col-sm-2">
                            <img src="https://image.rocketpunch.com/company/105846/khjeongbogyoyugweon_logo_1572925088.png?s=400x400&t=inside" class="room-image">
                        </div>
                        <div class="col-sm-10">
                            <h2>[KH정보교육원]</h2>
                            <h3>풀스택 개발자 양성과정</h3>
                            <p>
                                <div class="d-flex align-items-baseline justify-content-between">
                                    <span>
                                        <i class="fa-solid fa-user"></i>
                                        27
                                    </span>
                                    <span>
                                        <i class="fa-solid fa-search me-2"></i>
                                        <i class="fa-solid fa-bookmark me-2"></i>
                                        <i class="fa-solid fa-share me-2"></i>
                                    </span>
                                </div>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- 작성하고자 하는 컨텐츠 내용 -->
                <div class="row mt-4"></div>
                <div class="row mt-4"></div>
                <div class="row mt-4"></div>
                <div class="row mt-4"></div>
                <div class="row mt-4"></div>
                <div class="row">
                    <div class="col message-wrapper">
                        <div class="message" v-for="(message, index) in messageList" :key="index"
                                        :class="{my:checkMyMessage(index)}">
                            <div class="profile-wrapper" v-if="!checkMyMessage(index)">
                                <img src="https://via.placeholder.com/100x100?text=P" width="100%"
                                    v-if="!checkSameTime(index)">
                            </div>
                            <div class="content-wrapper">
                                <div class="content-header" v-if="!checkSameTime(index)">{{message.memberId}}</div>
                                <div class="content-body">
                                    <div class="message-wrapper">{{message.content}}</div>
                                    <div class="info-wrapper">
                                        <div class="number-wrapper">1</div>
                                        <div class="time-wrapper" v-if="calculateDisplay(index)">{{timeFormat(message.time)}}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4"></div>
                <div class="row mt-4"></div>
                <div class="row mt-4"></div>
                <div class="row mt-4"></div>
                <div class="row mt-4"></div>
                <div class="row mt-4"></div>
                <div class="row mt-2"></div>

                <div class="input-wrapper">
                    <div class="textarea-wrapper">
                        <textarea v-model="text"></textarea>
                    </div>
                    <div class="button-wrapper">
                        <i class="fa-solid fa-smile"></i>
                        <button class="btn-send" v-bind:disabled="text.length == 0">전송</button>
                    </div>
                </div>

            </div>
        </div>

        
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/ko.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/vue@3.2.36"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <script>
        Vue.createApp({
            //데이터 설정 영역
            data(){
                return {
                    text:"",
                    memberId:"testuser119",
                    messageList:[
                        {memberId:"testuser123", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser119", memberLevel:"일반회원", content:"내가 보낸 메세지 테스트!", time:moment()},
                        {memberId:"testuser123", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser125", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser125", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser125", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser123", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser127", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser127", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser123", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser123", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser122", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser123", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser123", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser123", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser123", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser123", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser123", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                        {memberId:"testuser123", memberLevel:"일반회원", content:"카카오톡 흉내내기!", time:moment()},
                    ],
                };
            },
            //데이터 실시간 계산 영역
            //- 사용하고 싶은 변수명으로 함수를 선언
            //- 함수 내부에는 보여주고 싶은 값을 코드로 반환하도록 작성
            //- Vue에 등록한 값에 접근할 때 반드시 this를 붙여야 함
            //- 코드가 길면 안됨(무리가 많이 감)
            computed:{

            },
            //메소드 영역
            //- 코드를 저장해두고 필요 시 호출할 수 있다
            //- 필요하다면 매개변수를 설정할 수 있고, 반환값을 가질 수 있다
            methods:{
               timeFormat(time){
                    return time.format("A h:mm");
               },
               checkSameTime(index) {
                    if(index == 0) return false;
                    const before = this.messageList[index-1];
                    const current = this.messageList[index];
                    
                    if(before.memberId != current.memberId) return false;
                    if(this.timeFormat(before.time) != this.timeFormat(current.time)) return false;
                    return true;
               },
               calculateDisplay(index) {
                    if(index + 1 == this.messageList.length) return true;
                    const after = this.messageList[index+1];
                    const current = this.messageList[index];
                    if(current.memberId != after.memberId) return true;
                    if(this.timeFormat(current.time) != this.timeFormat(after.time)) return true;
                    return false;
               },
               checkMyMessage(index) {
                    if(this.memberId == this.messageList[index].memberId) return true;
                    return false;
               }
            },
            //감시 영역(watch)
            //- data의 변동사항이 생기면 자동으로 실행되는 영역
            //- computed와 유사한 역할을 수행하지만 다름
            //- computed는 새로운 값을 계산하는 용도
            //- watch는 데이터가 변했을 때 특정 코드를 실행하는 용도
            watch:{
                
            },
        }).mount("#app");
    </script>
</body>
</html>